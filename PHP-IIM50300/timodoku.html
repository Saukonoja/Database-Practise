
<!DOCTYPE html>
<html>
   <head>
         <meta name="viewport" content="width=device-width, initial-scale=1.0">   
   		<link rel="stylesheet" type="text/css" href="styles2.css">
         <link rel="shortcut icon" href="https://image.freepik.com/free-icon/square-brackets_318-11293.png">
      	<title>IIM50300-loppudokumentaatio | Janne Hakala</title>
   </head>

   <body>
      <div id="content">
         <div id="main">
         <header><p>22.04.2016</p></header>

   	   <h1 id="header">Loppudokumentaatio</h1>

         <h2>Janne Hakala</h2>
         <h2>Timo Saukonoja</h2> 
         <h3>Music database</h3>
         <h3>Palvelinohjelmointi - IIM50300</h3>

         <p>Tällä sivulla selvennetään harjoitustyössämme käytettyjä ratkaisuja ja avataan niiden toiminnallisuutta.</p>

         <a href="https://github.com/Saukonoja/Database-Practise/wiki">Harjoitustyö - Suunnitelma</a><br>
         <a href="http://student.labranet.jamk.fi/~H3298/iim50300/Music-database">Harjoitustyö - Music database</a><br>
         <a href="https://github.com/Saukonoja/Database-Practise/tree/master/PHP-IIM50300">Harjoitustyö - (source code)</a><br>
         <a href="TODO">Harjoitustyö - (zip)</a>

         <h2>Sisältö</h2>
            <ol>
               <li><a href="#head1">Johdanto</a></li>
               <li><a href="#head2">Tehtävän kuvaus</a></li>
               <li><a href="#head3">Music database</a></li>
            <ul>
               <li>3.1 <a href="#head4"> Sisältö</a></li>
               <li>3.2 <a href="#head5"> Toteutus</a></li>
               <li>3.3<a href="#head6"> Rakenne</a></li>
               <li>3.4 <a href="#head7"> Käytetyt tekniikat</a></li>
               <li>3.5 <a href="#head8"> Aikataulutus</a></li>
            </ul>
               <li><a href="#head9">Lopputulema</a></li>
            
         </ol>
         <div id="textcontent">
            <h2 id="head1">1. Johdanto</h2>
               <p>Tällä sivulla on dokumentoitu Palvelinohjelmointi -kurssin harjoitustyö. Edempänä tullaan selventämään harjoitustyön sisältö, käytetyt tekniikat sekä kaikki, mitä tämän 
                  harjoitustyön toteuttaminen vaati.
               </p>
            <h2 id="head2">2. Tehtävän kuvaus</h2>
               <p>Tavoitteenamme oli toteuttaa Tietokannat -kurssille tehdylle MySQL -tietokannalle PHP -pohjainen käyttöliittymä. Käyttöliittymän avulla musiikkitietokannan sisältöä voi selata, kuunnella, lisätä, hakea, muokata ja poistaa. Sovellus on suunnattu kaikille musiikista kiinnostuneille. Sovellukseen on mahdollista kirjautua järjestelmänvalvojana, joka voi korottaa peruskäyttäjän oikeudet Admin -oikeuksiksi. Vieraskäyttäjä voi rekisteröityä sovellukseen peruskäyttäjäksi. Vieraskäyttäjä voi ainoastaan selata sisältöä. Peruskäyttäjällä on oikeudet kaikkeen muuhun paitsi käyttäjäoikeuksien muuttamiseen. 
               </p>

            <h2 id="head3">3. Music database</h2>
            <div class="indent">
               <h2 id="head4">3.1 Sisältö</h2>
                  <p>Music databasen käyttöliittymä koostuu hakupalkista, kirjautumispainikkeista sekä navigointivalikosta ja sen näyttämistä datatauluista. Esimerkiksi artistit valikkoa klikkaamalla listataan kaikki tietokannan artistit ja artistin nimeä klikkaamalla päästään artistin albumeita selaamaan. Albumia klikkaamalla listataan kaikki albumin kappaleet ja kappaletta klikkaamalla voidaan kuunnella kappaletta YouTube -videon avulla. Navigointi on samankaltainen kaikilla muillakin navigointivalikon sivuilla. 
                  </p>
                  
               <h2 id="head5">3.2 Toteutus</h2>
                  <p><b>Janne:</b> <br><br>
                     Aloitin käyttöliittymän ulkoasun toteuttamisen muutamia viikkoja ennemmin kuin varsinaisen sisällön tekeminen aloitettiin. Tämän jälkeen tein perusselailun kuntoon artistille ja navigoinnin artistista artistisivulle. Tämän jälkeen albumin tietojen selailu ja kappaletta klikattaessa YouTube -video upotettiin selaimeen näkyville. Tein myös tarvittavat kyselyt tietokantaan datan näyttämistä varten. Tämän jälkeen tein kappalesivulle paginaation siten, että yhdellä sivulla näytetään vain 10 kappaletta kerrallaan. Tein myös kaikille taulukoille kentän otsikon mukaisen järjestämisen klikkaamalla kyseistä otsikkoa. Timon tehdessä ensimmäistä CRUDIA jatkoin sitä tekemällä tarvittavat tyylimäärittelyt nappuloille ja muille elementeille. Seuraavaksi tein rekisteröintiin validoinnin eli käyttäjän tulee syöttää rekisteröintitiedot oikeassa muodossa. Tämän asian tarkistin käyttämällä säännöllisiä lausekkeita. Tein myös virheilmoitukset rekisteröintiin ja kirjautumiseen käyttäjän antaessa virheelliset syötteet. 
                  </p>   
                  <p>Loppupuolella tein myös koko kansiorakenteen uudelleenjärjestämisen, koska kaikki tiedostot olivat yhdessä ja samassa kansiossa, mikä teki loppuvaiheessa tiedostojen käsittelystä haastavaa. Tämän 
                     tekeminen osoittautui yllättävän työlääksi, koska tässä työssä tiedostoja on verrattain paljon ja kaikissa tiedostoissa on linkityksiä toisiinsa, joten uusien linkitysten tekeminen vei aikaa. Viimeisinä palikoina tein myös etusivulle nähtäväksi kävijälaskurin kahdella eri tekniikalla. Ensimmäinen versio kertoo sovellusta käyttäneiden käyttäjien määrän ja toinen kertoo kyseisen käyttäjän vierailut sivustollamme. Ensimmäinen tapa on toteutettu käyttämällä session -muuttujaa, joka tallennetaan tiedostoon aina, kun uusi sessio on aloitettu. Uuden käyttäjän siirtyessä sivustolle tiedostosta luetaan vanha arvo ja sitä kasvatetaan aina yhdellä ja tallennetaan uudestaan tiedostoon. Toinen tapa on toteutettu evästeiden avulla, jolloin luodaan uusi eväste mikäli vanhaa ei ole tai kasvatetaan vanhan evästeen arvoa. Eväste on määritetty vanhentumaan kuukauden jälkeen.
                  </p> 

                  <p><b>Timo:</b><br><br>
                     Ensimmäisenä lähdin tekemään projektin kirjautumislogiikkaa. Tämä tuntui kuitenkin aluksi hankalalta hashayksen kanssa, joten muutaman tunnin pähkäiltyän ajattelin aloittaa helpommasta päästä ja tein yksinkertaisen hashaamattoman rekisteröitymisen kannan User -tauluun. Tämän jälkeen aloitin CRUD:n luomisen Artists -taululle ja melko pian artisteja pystyi jo lisäilemään ja pian tämän jälkeen muokkaamaan/poistamaan. Seuraavaksi kokeilin onneani hakutoiminnon kanssa. Kyselyiden parametrien bindauksien luomien pienten vaikeuksien jälkeen haku lähti kuin lähtikin toimimaan artistit -sivulla. Näistä onnistumisista saadulla uudella itseluottamuksella lähdin taklaamaan takaraivossani jyskyttänyttä ongelmaa: kirjautumista. Usean tunnin taistelun jälkeen myös kirjautuminen toimi hashaamättömillä salasanoilla ja käyttäjänimellä varustettu sessiomuuttuja seurasi liikkumista headerissa. </p>

                     <p>Versionhallintaan käytimme Github-palvelua ja vastasin sen oikeasta käytöstä sekä toimivuudesta projektimme kannalta. Satunnaisia ja pienehköjä ongelmia lukuunottamatta versionhallinta toimi hyvin ja olisi luultavasti ollut huomattavan paljon hankalampaa ilman. Kirjatumisen jälkeen parantelin artisti -taulun CRUD:a käyttämään SQLinjectiolta suojattuja bindauksia. Pelkoa herättänyt hashays oli yllättävän kivuton rakentaa jo valmiin rekisteröitymis/kirjautumislogiikan päälle. Tästä eteenpäin uusia palikoita ei juuri tullutkaan muiden sivujen CRUD:it ovat pitkäli copypastea artistiin vaivalla tehdystä. Loppuaika meni pitkälti pieneen viilaukseen ja työtä aiheutti myös vasta lopussa tullut kansiorakenne, johon uudet CRUD:iin liittyvät sivut piti mukauttaa.</p>
                 
                  <h2 id="head6">3.3 Rakenne</h2>

                  <p>Sovelluksen luokkarakenne löytyy alla olevasta linkistä.</p><br>

                   <a href="http://student.labranet.jamk.fi/~H3694/cdData/DatabaseClassDiagram.class.violet.html">Luokka-kaavio</a>

                  <p>Metodin tai atribuutin edessä olevat merkit kertovat niiden näkyvyyden muille luokille: + (public), - (private), # (protected). Esimerkkinä Artist -luokka listaa kaikki kannasta löytyvät artistit olioina ja ArtistView -luokka listaa kaikki yksittäisen artistin albumit olioina. Toiminnallisuus on sama kaikilla muillakin luokilla. AlbumView -luokka listaa kaikki yksittäisen albumin kappaleet olioina. Kaikki alkuperäisessä luokkamallissa suunnitellut luokat eivät toteuttuneet siinä esitetyllä tavalla. Esimerkiksi käyttäjätyypeillä ei ole luokkia vaan heillä on ainoastaan oma sessiomuuttuja, joka tietää heidän käyttäjätyyppinsä. Myöskään login ja register ikkunat eivät käytä LoginView luokkaa.
                  </p>
                
                 <p>Mielestämme luokkarakenteen suunnittelussa ja toteutuksessa onnistuimme suhteellisen hyvin. Olemme tyytyväisiä lopputulokseen.</p>

                 <p>Sovelluksen tietokantarakenne löytyy alla olevasta linkistä</p><br>
                 <a href="https://camo.githubusercontent.com/6ab5d2b473af07fe2c63d5d7e286ca1b0b4f2009/687474703a2f2f692e696d6775722e636f6d2f7558584f5a68552e706e67">Tietokanta-kaavio</a>

                 <p>Tietokantamme koostuu 11 taulusta. Osa viittauksista on toteutettu välitaulun avulla. Esimerkiksi esittäjällä on monta cd-levyjä ja cd-levyllä on useita kappaleita. Cd-levyllä on yksi levy-yhtö ja levy-yhtiöllä voi olla useita Cd-levyjä jne. Esimerkiksi Artisti -sivulla näkyvät tiedot haetaan kolmesta eri taulusta.</p>

                 
                  <h2 id="head7">3.4 Käytetyt tekniikat</h2>
                  <p>Music Database on toteutettu osittain Oliopohjaisesti käyttäen PHP:ta, MySQL tietokantaa ja LabraNetin palvelinta.</p>
                  <p>Tässä projektissa käytimme seuraavia tekniikoita: (esimerkki kuvat alla)</p>

                  <ol class="technics">
                     <li>PHP-perus (muuttujat, tietotyypit, operaattorit, aliohjelmat, ohjausrakenteet)</li>
                     <li>HTML-lomake ja lomakedatan vastaanotto</li><br>
                     <p>Funktio, muuttujat, lomake ja operaattori nähtävissä alla.</p>
                     <img src="images/image1.png"></img><br><br>
                     <li>Navigointivalikon upotus</li><br>
                     <p>Include -funktiolla upotetaan navigointivalikot joka sivulle</p>
                     <img src="images/image2.png"></img><br><br>
                     <li>Evästeet</li><br>
                     <p>Luodaan eväste kuukaudeksi kävijälaskuria varten</p>
                     <img src="images/image3.png"></img><br><br>   
                     <li>Poikkeusten käsittely</li><br>
                     <p>Try {} catch{} lohkon sisällä poikkeusten käsittely tietokanta yhteyden kanssa.</p>
                     <img src="images/image4.png"></img><br><br>
                     <li>Istunnon hallinta</li><br>
                     <p>Istunnon hallintaa session muuttujien avulla käyttäjän kirjautumiselle.</p>
                     <img src="images/image5.png"></img><br><br>            
                     <li>Autentikointimenetelmät</li><br>
                     <p>Autentikointimenetelmä kirjautumiselle: tarkistetaan salasanan vastaavuus tietokannasta ja luodaan käyttäjälle istunto, jos kirjautuminen onnistui.</p>
                     <img src="images/image6.png"></img><br><br>            
                     <li>Olio-ohjelmointi</li><br>
                     <p>Luokan luominen PHP:lla ja luokan käyttö luomalla Genre -luokasta genre olioita</p>
                     <img src="images/image7.png"></img><br><br>        
                     <li>Tekstitiedoston kirjoittaminen ja lukeminen</li><br>
                     <p>Tiedostoon kirjoitetaan vierailtujen käyttäjien määrä ja se luetaan sieltä sivun latautuessa.</p>
                     <img src="images/image8.png"></img><br><br>
                     <li>Tietokannat(MySQL)</li>                    
                     <li>SQL injectionin estäminen</li><br>
                     <p>Esimerkki salasanan salaamisesta BCrypt -kirjaston avulla. Estetään SQL injektio suorittamalla kysely ensin käyttämällä prepare metodia. Täten käyttäjä ei voi vaikuttaa väärin kyselyn sisältöön. Esimerkiksi syöttämällä vaarallisia sql lauseita "Drop table...".</p>
                     <img src="images/image9.png"></img><br><br>
                     <li>Salasanojen hashays(BCrypt)</li><br>
                     <p>Salasanan hashays functio sekä salasanan tarkistaminen</p>
                     <img src="images/image10.png"></img><br><br>
                     <li>Merkkijonon muuttaminen (htmlspecialchars)</li><br>
                     <p>Muutetaan merkkijonoa siten, että selain ymmärtää sanan jossa esiintyy heittomerkki. Esimerkiksi kappaleen nimi: "Childhood's End".</p>
                     <img src="images/image11.png"></img><br><br>
                     <li>Säännölliset lausekkeet</li><br>
                     <p>Säännöllisellä lausekkeella varmistetaan, että käyttäjä on syöttänyt oikeanlaisia merkkejä teksikenttään kirjautumisessa ja rekisteröitymisessä.</p>
                     <img src="images/image12.png"></img>
                  </ol>

               <h2 id="head8">3.5 Aikataulutus</h2>
               <p>Projektin aikataulu ja toteutus työtunteineen sekä tehtävineen on nähtävissä alla.</p>
               <p><b>Timo:</b></p>

                  <ul class="technics" style="list-style-type:square">                    
                     <li>Login/register(logiikka)</li>
                     <li>CRUD</li>
                     <li>Search</li>
                     <li>Hash</li>
                     
                  </ul>
                  <p>Käytetty aika yhteensä: 58h</p>

                  <p><b>Janne:</b></p>
                   <ul class="technics" style="list-style-type:square">             
                     <li>UI/CSS</li>
                     <li>Sivujen luonti datan näyttäminen ja niihin tarvittavat kyselyt</li>
                     <li>Login/register(Regex, tyylit, virheilmoitukset)</li>
                     <li>Paginaatio ja otsikon mukaan sorttaus</li>
                     <li>Hakemistorakenne</li>
                     <li>Kävijälaskurit</li>
                  </ul>
                  <p>Käytetty aika yhteensä: h</p> 

                  <p>Yhteensä: h</p>
            </div>
            <h2 id="head9">4. Lopputulema</h2>
            <h3>Näissä asioissa onnistuttiin</h3>
              <ul class="technics" style="list-style-type:square">    
                  <li>Tietokannan sisällön näyttäminen käyttäjälle</li>
                  <li>Haluttu CRUD</li>
                  <li>Youtube -integraatio</li>
                  <li>Selkeä käyttöliittymä ja hyvä käytettävyys</li>
                  <li>Rekisteröityminen ja kirjautuminen (salaukset)</li>                   
               </ul>
            <h3>Nämä jäivät puuttumaan</h3>
               <ul class="technics" style="list-style-type:square">             
                  <li>XML-tiedoston hyväksikäyttö omien soittolistojen kanssa</li>
                  <li>Albumin kuvan lataaminen palvelimelle</li>                      
               </ul>
            <h3>Itsearviot</h3>
            <h4>Janne:</h4>
            <p>Tämäkin opintojakso on ollut aivan uutta asiaa, eikä tässä koulussa yksikään kurssi olekaan ohjelmoinnin puitteissa ollut ennestään tuttua. Kuitenkin jokaiseen ohjelmointijaksoon suhtaudun positiivisella asenteella ja avoimin mielin, koska tulevaisuudessa ohjelmoiinti nousee yhä isompaan rooliin. Varsinkin, kun peruskoulussa aletaan syksyllä jossain määrin sivuamaan jo ohjelmointikoulutusta. Mielestäni omalta osaltani opintojakson tavoitteisiin on päästy ja olen kyllä tyytyväinen lopputulokseen kaikilta osa-alueilta. Työtunteja tämäkin harjoitustyö vaati totutusti reippaan määrän, koska periaatteena on ollut muillakin kursseilla se, että tehdä suhteellisen laaja ja kaikin puolin viimeiseen asti viilattu työ, vaikka aikaa onkin rajallisesti.  Mielestäni saimme puskettua hyvin onnistuneen kokonaisuuden tämän kurssin harjoitustyöksi. Taas on yksi uusi ohjelmointikieli takataskussa ja nyt voi hyvillä mielillä jäädä kesäloman viettoon.</p>
            <p>Arvosana ehdotukseni on 4.75</p>
            <h4>Timo:</h4>
            <p>Tämä opintojakso antoi minulle hyvän yleiskuvan web-pohjaisesta palvelinohjelmoinnista. Erityisesti pidin tietokantojen kanssa värkkäilystä, joten parhaiten kurssin sisällöstä hallitsen kyselyt sekä niiden tuoman sisällön näyttämisen käyttäjälle. Jakson asioista kertausta tai syvempää tutustumista vaatii frameworkit ja niiden käyttö, sillä tällä hetkellä mielessä melko häilyvä kuva niiden eduista tai haitoista. Opiskeluni kannalta olen melko tyytyväinen opiskelutapoihini ja tehtyyn työmäärään, mutta parannettavaa voisi olla kotitehtävien tunnollisemmassa tekemisessä(tehdä useammin ja viimeistellä kunnolla). Harjoitustyön aihe oli huomattavan laaja, joten tekemiseen ja viilaukseen upposi reilusti tunteja niin kotona kuin koulussakin. Olen tyytyväinen ryhmän dynamiikkaan ja hyvin onnistuneeseen työnjakoon. Olen erittäin tyytyväinen lopputulokseen se näyttää hyvältä ja on mukava käyttää juuri niinkuin halusimmekin.</p>
            <p>Arvosana ehdotukseni on 4.25</p>  
         </div>
      </div>
      </div>   
   </body>
</html>